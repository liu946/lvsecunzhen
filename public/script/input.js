// Generated by CoffeeScript 1.9.3
var getformvalue, getinputname, getkeyvalue, htmlstring, inputs, putmodel, value;

getkeyvalue = function(url) {
  return $.ajax({
    url: url,
    dataType: 'json',
    async: false
  }).done(function(data) {
    return data;
  }).fail(function() {
    return alert("获取失败！请刷新页面");
  }).always(function() {
    return console.log("complete");
  });
};

putmodel = function(string, objecct, inputs) {
  var a, b, dataType, fieldid, fieldname, html, id, j, k, len, ref, str, title;
  html = "";
  for (k in objecct) {
    a = objecct[k];
    title = a.classname;
    console.log(a);
    id = a["class"];
    html = "<div id='" + id + "' class='content'> <h1>" + title + "</h1>";
    ref = a.childfield;
    for (j = 0, len = ref.length; j < len; j++) {
      b = ref[j];
      fieldname = b.fieldname;
      fieldid = b.field;
      dataType = b.datatype;
      inputs = getinputname(fieldid, inputs);
      str = "<input type='text' id='" + fieldid + "' name='" + fieldid + "' />";
      html += "<div class='list'> <div class='note'> <h3>" + fieldname + "</h3> </div> <div class='input'> " + str + " </div> </div>";
    }
    html += "</div><hr />";
    string += html;
  }
  $('#J_form').append(string);
  return inputs;
};

getinputname = function(value, target) {
  var a, j, len;
  for (j = 0, len = target.length; j < len; j++) {
    a = target[j];
    if (a === value) {
      return target;
    }
  }
  target.push(value);
  return target;
};

getformvalue = function(array) {
  var data, flag, i, j, len, target, targetvalue;
  data = {
    "id": id
  };
  flag = 0;
  for (j = 0, len = array.length; j < len; j++) {
    i = array[j];
    target = i;
    targetvalue = $("input[name=" + target + "]").val();
    if (targetvalue = '') {
      flag = 1;
    }
    data["" + target] = targetvalue;
  }
  return {
    data: data,
    flag: flag
  };
};

value = JSON.parse(getkeyvalue('/input/field').responseText);

htmlstring = "";

inputs = [];

inputs = putmodel(htmlstring, value, inputs);

$("input[type='radio']").on('click', function() {
  return judgeother(this);
});

$("input[type='checkbox']").on('click', function() {
  return judgeother(this);
});

$('.save').on('click', function() {
  var target;
  target = getformvalue(inputs);
  value = target.data;
  return $.post('', value, function(data) {
    return console.log(data);
  });
});

$('.submit').on('click', function() {
  var target;
  target = getformvalue(inputs);
  value = target.data;
  if (target.flag) {
    return alert("没有填写完整，请检查");
  } else {
    return $.post('', value, function(data) {
      return console.log(data);
    });
  }
});
